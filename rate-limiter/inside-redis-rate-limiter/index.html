<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Inside Redis Rate Limiter – Nextra</title><meta name="robots" content="index,follow"/><meta property="og:title" content="Inside Redis Rate Limiter – Nextra"/><meta name="theme-color" content="#111" media="(prefers-color-scheme: dark)"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/><style>
        :root {
          --nextra-primary-hue: 212deg;
          --nextra-primary-saturation: 100%;
          --nextra-navbar-height: 4rem;
          --nextra-menu-height: 3.75rem;
          --nextra-banner-height: 2.5rem;
        }
        
        .dark {
          --nextra-primary-hue: 204deg;
          --nextra-primary-saturation: 100%;
        }
      </style><meta name="msapplication-TileColor" content="#fff"/><meta http-equiv="Content-Language" content="en"/><meta name="description" content="Nextra: the next docs builder"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@shuding_"/><meta property="og:title" content="Nextra: the next docs builder"/><meta property="og:description" content="Nextra: the next docs builder"/><meta name="apple-mobile-web-app-title" content="Nextra"/><meta name="next-head-count" content="15"/><link rel="preload" href="/docs-spring-cloud-gateway/_next/static/css/445c4173ffc2bf04.css" as="style" crossorigin=""/><link rel="stylesheet" href="/docs-spring-cloud-gateway/_next/static/css/445c4173ffc2bf04.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/docs-spring-cloud-gateway/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/docs-spring-cloud-gateway/_next/static/chunks/webpack-52a7de47a3813206.js" defer="" crossorigin=""></script><script src="/docs-spring-cloud-gateway/_next/static/chunks/framework-0c7baedefba6b077.js" defer="" crossorigin=""></script><script src="/docs-spring-cloud-gateway/_next/static/chunks/main-4afb1a3a929a727e.js" defer="" crossorigin=""></script><script src="/docs-spring-cloud-gateway/_next/static/chunks/pages/_app-c54702eb327175a3.js" defer="" crossorigin=""></script><script src="/docs-spring-cloud-gateway/_next/static/chunks/796-b80b9c835a4bea52.js" defer="" crossorigin=""></script><script src="/docs-spring-cloud-gateway/_next/static/chunks/pages/rate-limiter/inside-redis-rate-limiter-ef15f33bdf2a7b5b.js" defer="" crossorigin=""></script><script src="/docs-spring-cloud-gateway/_next/static/Pl6EMUw0X40lqWZeQ6ErJ/_buildManifest.js" defer="" crossorigin=""></script><script src="/docs-spring-cloud-gateway/_next/static/Pl6EMUw0X40lqWZeQ6ErJ/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div dir="ltr"><script>document.documentElement.setAttribute('dir','ltr')</script><div class="nextra-nav-container nx-sticky nx-top-0 nx-z-20 nx-w-full nx-bg-transparent print:nx-hidden"><div class="nextra-nav-container-blur nx-pointer-events-none nx-absolute nx-z-[-1] nx-h-full nx-w-full nx-bg-white dark:nx-bg-dark nx-shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] dark:nx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:nx-shadow-[0_0_0_1px_#000] contrast-more:dark:nx-shadow-[0_0_0_1px_#fff]"></div><nav class="nx-mx-auto nx-flex nx-h-[var(--nextra-navbar-height)] nx-max-w-[90rem] nx-items-center nx-justify-end nx-gap-2 nx-pl-[max(env(safe-area-inset-left),1.5rem)] nx-pr-[max(env(safe-area-inset-right),1.5rem)]"><a class="nx-flex nx-items-center hover:nx-opacity-75 ltr:nx-mr-auto rtl:nx-ml-auto" href="/docs-spring-cloud-gateway/"><span>Docs Spring Cloud Gateway</span></a><a href="-" target="_blank" rel="noreferrer" class="nx-text-sm contrast-more:nx-text-gray-700 contrast-more:dark:nx-text-gray-100 nx-relative -nx-ml-2 nx-hidden nx-whitespace-nowrap nx-p-2 md:nx-inline-block nx-text-gray-600 hover:nx-text-gray-800 dark:nx-text-gray-400 dark:hover:nx-text-gray-200" aria-current="false"><span class="nx-absolute nx-inset-x-0 nx-text-center">Contact ↗</span><span class="nx-invisible nx-font-medium">Contact ↗</span><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a><div class="nextra-search nx-relative md:nx-w-64 nx-hidden md:nx-inline-block mx-min-w-[200px]"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div><a href="https://github.com/chagchagchag/docs-spring-cloud-gateway" target="_blank" rel="noreferrer" class="nx-p-2 nx-text-current"><svg width="24" height="24" fill="currentColor" viewBox="3 3 18 18"><title>GitHub</title><path d="M12 3C7.0275 3 3 7.12937 3 12.2276C3 16.3109 5.57625 19.7597 9.15374 20.9824C9.60374 21.0631 9.77249 20.7863 9.77249 20.5441C9.77249 20.3249 9.76125 19.5982 9.76125 18.8254C7.5 19.2522 6.915 18.2602 6.735 17.7412C6.63375 17.4759 6.19499 16.6569 5.8125 16.4378C5.4975 16.2647 5.0475 15.838 5.80124 15.8264C6.51 15.8149 7.01625 16.4954 7.18499 16.7723C7.99499 18.1679 9.28875 17.7758 9.80625 17.5335C9.885 16.9337 10.1212 16.53 10.38 16.2993C8.3775 16.0687 6.285 15.2728 6.285 11.7432C6.285 10.7397 6.63375 9.9092 7.20749 9.26326C7.1175 9.03257 6.8025 8.08674 7.2975 6.81794C7.2975 6.81794 8.05125 6.57571 9.77249 7.76377C10.4925 7.55615 11.2575 7.45234 12.0225 7.45234C12.7875 7.45234 13.5525 7.55615 14.2725 7.76377C15.9937 6.56418 16.7475 6.81794 16.7475 6.81794C17.2424 8.08674 16.9275 9.03257 16.8375 9.26326C17.4113 9.9092 17.76 10.7281 17.76 11.7432C17.76 15.2843 15.6563 16.0687 13.6537 16.2993C13.98 16.5877 14.2613 17.1414 14.2613 18.0065C14.2613 19.2407 14.25 20.2326 14.25 20.5441C14.25 20.7863 14.4188 21.0746 14.8688 20.9824C16.6554 20.364 18.2079 19.1866 19.3078 17.6162C20.4077 16.0457 20.9995 14.1611 21 12.2276C21 7.12937 16.9725 3 12 3Z"></path></svg><span class="nx-sr-only">GitHub</span><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a><button type="button" aria-label="Menu" class="nextra-hamburger -nx-mr-2 nx-rounded nx-p-2 active:nx-bg-gray-400/20 md:nx-hidden"><svg fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" class=""><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16"></path></g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16"></path><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 18h16"></path></g></svg></button></nav></div><div class="nx-mx-auto nx-flex nx-max-w-[90rem]"><div class="motion-reduce:nx-transition-none [transition:background-color_1.5s_ease] nx-bg-transparent"></div><aside class="nextra-sidebar-container nx-flex nx-flex-col md:nx-top-16 md:nx-shrink-0 motion-reduce:nx-transform-none nx-transform-gpu nx-transition-all nx-ease-in-out print:nx-hidden md:nx-w-64 md:nx-sticky md:nx-self-start max-md:[transform:translate3d(0,-100%,0)]"><div class="nx-px-4 nx-pt-4 md:nx-hidden"><div class="nextra-search nx-relative md:nx-w-64"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div></div><div class="nx-overflow-y-auto nx-overflow-x-hidden nx-p-4 nx-grow md:nx-h-[calc(100vh-var(--nextra-navbar-height)-var(--nextra-menu-height))] nextra-scrollbar"><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100"><ul class="nx-flex nx-flex-col nx-gap-1 nextra-menu-desktop max-md:nx-hidden"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/docs-spring-cloud-gateway/">Introduction</a></li><li class="open"><a class="nx-items-center nx-justify-between nx-gap-2 nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/docs-spring-cloud-gateway/rate-limiter/">Rate Limiter<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-h-[18px] nx-min-w-[18px] nx-rounded-sm nx-p-0.5 hover:nx-bg-gray-800/5 dark:hover:nx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="nx-origin-center nx-transition-transform rtl:-nx-rotate-180 ltr:nx-rotate-90 rtl:nx-rotate-[-270deg]"></path></svg></a><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100 ltr:nx-pr-0 rtl:nx-pl-0 nx-pt-1"><ul class="nx-flex nx-flex-col nx-gap-1 nx-relative before:nx-absolute before:nx-inset-y-1 before:nx-w-px before:nx-bg-gray-200 before:nx-content-[&quot;&quot;] dark:before:nx-bg-neutral-800 ltr:nx-pl-3 ltr:before:nx-left-0 rtl:nx-pr-3 rtl:before:nx-right-0 ltr:nx-ml-3 rtl:nx-mr-3"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/docs-spring-cloud-gateway/rate-limiter/what-is-rate-limiter/">RateLimiter 의 개념</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/docs-spring-cloud-gateway/rate-limiter/redis-docker-compose/">Redis docker-compose</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/docs-spring-cloud-gateway/rate-limiter/example-rate-limiter/">RateLimiter 예제</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/docs-spring-cloud-gateway/rate-limiter/example-custom-rate-limiter/">Custom Rate Limiter 예제</a></li><li class="nx-flex nx-flex-col nx-gap-1 active"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-bg-primary-100 nx-font-semibold nx-text-primary-800 dark:nx-bg-primary-400/10 dark:nx-text-primary-600 contrast-more:nx-border-primary-500 contrast-more:dark:nx-border-primary-500" href="/docs-spring-cloud-gateway/rate-limiter/inside-redis-rate-limiter/">RedisRateLimiter의 내부 동작</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/docs-spring-cloud-gateway/rate-limiter/token-bucket-algorithm/">Token Bucket Algorithm (Lua)</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/docs-spring-cloud-gateway/rate-limiter/redis-rate-limiter/">Redis Rate Limiter</a></li></ul></div></div></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/docs-spring-cloud-gateway/filter/">Filter</a></li></ul></div></div></div><div class="nx-sticky nx-bottom-0 nx-bg-white dark:nx-bg-dark nx-mx-4 nx-py-4 nx-shadow-[0_-12px_16px_#fff] nx-flex nx-items-center nx-gap-2 dark:nx-border-neutral-800 dark:nx-shadow-[0_-12px_16px_#111] contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-shadow-none nx-border-t" data-toggle-animation="off"><div class="nx-grow nx-flex nx-flex-col"><button title="Change theme" class="nx-h-7 nx-rounded-md nx-px-2 nx-text-left nx-text-xs nx-font-medium nx-text-gray-600 nx-transition-colors dark:nx-text-gray-400 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50" id="headlessui-listbox-button-:Rlsr6:" type="button" aria-haspopup="listbox" aria-expanded="false" data-headlessui-state=""><div class="nx-flex nx-items-center nx-gap-2 nx-capitalize"><svg fill="none" viewBox="3 3 18 18" width="12" height="12" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="currentColor" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><span class="">Light</span></div></button></div></div></aside><nav class="nextra-toc nx-order-last nx-hidden nx-w-64 nx-shrink-0 xl:nx-block print:nx-hidden nx-px-4" aria-label="table of contents"><div class="nextra-scrollbar nx-sticky nx-top-16 nx-overflow-y-auto nx-pr-4 nx-pt-6 nx-text-sm [hyphens:auto] nx-max-h-[calc(100vh-var(--nextra-navbar-height)-env(safe-area-inset-bottom))] ltr:-nx-mr-4 rtl:-nx-ml-4"><p class="nx-mb-4 nx-font-semibold nx-tracking-tight">On This Page</p><ul><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#redisratelimiter-의-내부-동작" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">RedisRateLimiter 의 내부 동작</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#requestratelimitergatewayfilterfactory" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">RequestRateLimiterGatewayFilterFactory</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#생성자" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">생성자</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#applyconfig" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">apply(Config)</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#ratelimiter" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">RateLimiter</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#redisratelimiter" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">RedisRateLimiter</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#redisratelimiterisallowed-메서드" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">RedisRateLimiter::isAllowed() 메서드</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#lua-스크립트" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">lua 스크립트</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#request_rate_limiterlua" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">request_rate_limiter.lua</a></li></ul><div class="nx-mt-8 nx-border-t nx-bg-white nx-pt-8 nx-shadow-[0_-12px_16px_white] dark:nx-bg-dark dark:nx-shadow-[0_-12px_16px_#111] nx-sticky nx-bottom-0 nx-flex nx-flex-col nx-items-start nx-gap-2 nx-pb-8 dark:nx-border-neutral-800 contrast-more:nx-border-t contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-border-neutral-400"><a href="https://github.com/chagchagchag/docs-spring-cloud-gateway/issues/new?title=Feedback%20for%20%E2%80%9CInside%20Redis%20Rate%20Limiter%E2%80%9D&amp;labels=feedback" target="_blank" rel="noreferrer" class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50">Question? Give us feedback →<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a><a class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50" href="https://github.com/chagchagchag/docs-spring-cloud-gateway/pages/rate-limiter/inside-redis-rate-limiter.mdx">Edit this page</a></div></div></nav><div id="reach-skip-nav"></div><article class="nx-w-full nx-break-words nextra-content nx-flex nx-min-h-[calc(100vh-var(--nextra-navbar-height))] nx-min-w-0 nx-justify-center nx-pb-8 nx-pr-[calc(env(safe-area-inset-right)-1.5rem)]"><main class="nx-w-full nx-min-w-0 nx-max-w-6xl nx-px-6 nx-pt-4 md:nx-px-12"><div class="nextra-breadcrumb nx-mt-1.5 nx-flex nx-items-center nx-gap-1 nx-overflow-hidden nx-text-sm nx-text-gray-500 dark:nx-text-gray-400 contrast-more:nx-text-current"><div class="nx-whitespace-nowrap nx-transition-colors nx-min-w-[24px] nx-overflow-hidden nx-text-ellipsis hover:nx-text-gray-900 dark:hover:nx-text-gray-100" title="Rate Limiter"><a href="/docs-spring-cloud-gateway/rate-limiter/">Rate Limiter</a></div><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-w-3.5 nx-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg><div class="nx-whitespace-nowrap nx-transition-colors nx-font-medium nx-text-gray-700 contrast-more:nx-font-bold contrast-more:nx-text-current dark:nx-text-gray-100 contrast-more:dark:nx-text-current" title="RedisRateLimiter의 내부 동작">RedisRateLimiter의 내부 동작</div></div><h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">RedisRateLimiter 의 내부 동작<a href="#redisratelimiter-의-내부-동작" id="redisratelimiter-의-내부-동작" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">RequestRateLimiterGatewayFilterFactory<a href="#requestratelimitergatewayfilterfactory" id="requestratelimitergatewayfilterfactory" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<blockquote class="nx-mt-6 nx-border-gray-300 nx-italic nx-text-gray-700 dark:nx-border-gray-700 dark:nx-text-gray-400 first:nx-mt-0 ltr:nx-border-l-2 ltr:nx-pl-6 rtl:nx-border-r-2 rtl:nx-pr-6">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">참고</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://github.com/spring-cloud/spring-cloud-gateway/tree/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/ratelimit" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/ratelimit<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/af09c72a9a5dbc2240fd5d3de8293a9b7b80750d/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/ratelimit/RedisRateLimiter.java" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">RequestRateLimiterGatewayFilterFactory<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/GatewayFilter.java" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">GatewayFilter<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/ratelimit/KeyResolver.java" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">KeyResolver<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/config/GatewayAutoConfiguration.java" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">GatewayAutoConfiguration<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></p>
</li>
</ul>
</blockquote>
<br/>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">생성자<a href="#생성자" id="생성자" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">RequestRateLimiterGatewayFilterFactory 는 GatewayFilter 객체를 생성하는 역할을 합니다. RequestRateLimiterGatewayFilterFactory 의 생성자 코드는 아래와 같습니다.</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="java" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="java" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">@</span><span style="color:var(--shiki-token-keyword)">ConfigurationProperties</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;spring.cloud.gateway.filter.request-rate-limiter&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">class</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">RequestRateLimiterGatewayFilterFactory</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">extends</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">AbstractGatewayFilterFactory</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">RequestRateLimiterGatewayFilterFactory</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">Config</span><span style="color:var(--shiki-color-text)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">private</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">final</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">RateLimiter</span><span style="color:var(--shiki-color-text)"> defaultRateLimiter;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	</span><span style="color:var(--shiki-token-keyword)">private</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">final</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">KeyResolver</span><span style="color:var(--shiki-color-text)"> defaultKeyResolver;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">RequestRateLimiterGatewayFilterFactory</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">RateLimiter</span><span style="color:var(--shiki-color-text)"> defaultRateLimiter</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">KeyResolver</span><span style="color:var(--shiki-color-text)"> defaultKeyResolver) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		super(</span><span style="color:var(--shiki-token-constant)">Config</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">class</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">defaultRateLimiter</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> defaultRateLimiter;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">defaultKeyResolver</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> defaultKeyResolver;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">defaultRateLimiter, defaultKeyResolver 는 사용자가 별도로 defaultRateLimiter, defaultKeyResolver 를 주입하지 않으면 Spring Cloud Gateway 내부적으로 의존성 주입을 합니다.<br/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">만약 RequestRateLimitGatewayFilterFactory 의 생성자를 이용해서 @Bean 설정을 직접 한다면, 위의 생성자를 통해서 객체를 생성해서 @Bean 으로 등록하며 defaultRateLimiter, defaultKeyResolver 에 해당하는 인자값에 실제 객체를 주입해주면 됩니다.<br/></p>
<br/>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">apply(Config)<a href="#applyconfig" id="applyconfig" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">이번에는 apply(Config) 메서드를 살펴봅니다.<br/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">뭔가 굉장히 어려운 내용인 것 같지만 그렇게 대단한 코드는 없습니다.</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="java" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="java" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">@</span><span style="color:var(--shiki-token-keyword)">ConfigurationProperties</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;spring.cloud.gateway.filter.request-rate-limiter&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">class</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">RequestRateLimiterGatewayFilterFactory</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">extends</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">AbstractGatewayFilterFactory</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">RequestRateLimiterGatewayFilterFactory</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">Config</span><span style="color:var(--shiki-color-text)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    @</span><span style="color:var(--shiki-token-keyword)">SuppressWarnings</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;unchecked&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	@</span><span style="color:var(--shiki-token-keyword)">Override</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	</span><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GatewayFilter</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">apply</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">Config</span><span style="color:var(--shiki-color-text)"> config) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">KeyResolver</span><span style="color:var(--shiki-color-text)"> resolver </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">getOrDefault(</span><span style="color:var(--shiki-token-constant)">config</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">keyResolver</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-function)"> defaultKeyResolver)</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">RateLimiter</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">Object</span><span style="color:var(--shiki-color-text)">&gt; limiter </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">getOrDefault(</span><span style="color:var(--shiki-token-constant)">config</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">rateLimiter</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-function)"> defaultRateLimiter)</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">boolean</span><span style="color:var(--shiki-color-text)"> denyEmpty </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">getOrDefault(</span><span style="color:var(--shiki-token-constant)">config</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">denyEmptyKey</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-function)"> </span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">denyEmptyKey</span><span style="color:var(--shiki-token-function)">)</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">HttpStatusHolder</span><span style="color:var(--shiki-color-text)"> emptyKeyStatus </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">HttpStatusHolder</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">parse</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-function)">getOrDefault(</span><span style="color:var(--shiki-token-constant)">config</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">emptyKeyStatus</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-function)"> </span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">emptyKeyStatusCode</span><span style="color:var(--shiki-token-function)">)</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-comment)">// 1)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> (exchange</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> chain) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">resolver</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">resolve</span><span style="color:var(--shiki-color-text)">(exchange)</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">defaultIfEmpty</span><span style="color:var(--shiki-color-text)">(EMPTY_KEY)</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">flatMap</span><span style="color:var(--shiki-color-text)">(key </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">EMPTY_KEY</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">equals</span><span style="color:var(--shiki-color-text)">(key)) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> (denyEmpty) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">					</span><span style="color:var(--shiki-token-function)">setResponseStatus(exchange</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-function)"> emptyKeyStatus)</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">					</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">exchange</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getResponse</span><span style="color:var(--shiki-color-text)">()</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">setComplete</span><span style="color:var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">chain</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">filter</span><span style="color:var(--shiki-color-text)">(exchange);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)"> routeId </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">config</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getRouteId</span><span style="color:var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            </span><span style="color:var(--shiki-token-comment)">// 2) </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> (routeId </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">null</span><span style="color:var(--shiki-color-text)">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">Route</span><span style="color:var(--shiki-color-text)"> route </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">exchange</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getAttribute</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-constant)">ServerWebExchangeUtils</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">GATEWAY_ROUTE_ATTR</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				routeId </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">route</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getId</span><span style="color:var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            </span><span style="color:var(--shiki-token-comment)">// 3)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">limiter</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">isAllowed</span><span style="color:var(--shiki-color-text)">(routeId</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> key)</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">flatMap</span><span style="color:var(--shiki-color-text)">(response </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> {</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">                </span><span style="color:var(--shiki-token-comment)">// 3-1)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">for</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">Map</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">Entry</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)">&gt; header </span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">response</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getHeaders</span><span style="color:var(--shiki-color-text)">()</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">entrySet</span><span style="color:var(--shiki-color-text)">()) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">					</span><span style="color:var(--shiki-token-constant)">exchange</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getResponse</span><span style="color:var(--shiki-color-text)">()</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getHeaders</span><span style="color:var(--shiki-color-text)">()</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">add</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-constant)">header</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getKey</span><span style="color:var(--shiki-color-text)">()</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">header</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getValue</span><span style="color:var(--shiki-color-text)">());</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                </span><span style="color:var(--shiki-token-comment)">// 3-2)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">response</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">isAllowed</span><span style="color:var(--shiki-color-text)">()) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">					</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">chain</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">filter</span><span style="color:var(--shiki-color-text)">(exchange);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                </span><span style="color:var(--shiki-token-comment)">// 3-3)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-function)">setResponseStatus(exchange</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-function)"> </span><span style="color:var(--shiki-token-constant)">config</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getStatusCode())</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">exchange</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getResponse</span><span style="color:var(--shiki-color-text)">()</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">setComplete</span><span style="color:var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			});</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		});</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">private</span><span style="color:var(--shiki-color-text)"> &lt;</span><span style="color:var(--shiki-token-keyword)">T</span><span style="color:var(--shiki-color-text)">&gt; </span><span style="color:var(--shiki-token-keyword)">T</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">getOrDefault</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">T</span><span style="color:var(--shiki-color-text)"> configValue</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">T</span><span style="color:var(--shiki-color-text)"> defaultValue) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> (configValue </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">null</span><span style="color:var(--shiki-color-text)">) </span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-color-text)"> configValue </span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> defaultValue;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">참고</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/ratelimit/KeyResolver.java" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">KeyResolver<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li>
<li class="nx-my-2"><a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/support/ServerWebExchangeUtils.java#L191" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">ServerWebExchangeUtils - <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GATEWAY_ROUTE_ATTR</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li>
</ul>
<br/>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">1)</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Exchange 를 KeyResolver 로 resolve() 한 결과가 null 이면 <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">EMPTY_KEY</code> 를 return 하고, 그 외의 경우는 flatMap(...) 을 통해 다음 처리로 넘어갑니다.</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">2) routeId 가 null 일 경우에 대한 설정입니다.</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">ServerWebExchangeUtils 에 정의된 키에 대해 Spring Webflux 의 ServerWebExchange 에 기본설정된 Gateway Router 에 대한 어트리뷰트 값(Value)을 얻어냅니다. 그리고 이 값은 Route 객체인데 이 기본 객체에 대한 routeId 를 얻어냅니다.</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">3) RateLimiter::isAllowed(routerId, key) 를 통해 얻어낸 Mono&lt;Response&gt; 를 flatMap 처리합니다. RateLimiter::isAllowed(routerId, key) 메서드는 뒤에서 정리합니다.</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">3-1) RateLimiter::isAllowed(routerId, key) 에서 만들어낸 Response 객체 내의 header 의 Key, Value 의 쌍 들을 모두 복사해서 Exchange 내의 header 에 복제합니다.</li>
<li class="nx-my-2">3-2) RateLimiter::isAllowed(routerId, key) 에서 만들어낸 Response 객체가 isAllowed 된 객체라면 chain.filter(exchange) 를 통해 다음 Filter 처리를 하도록 DispatcherHandler 에게 전달합니다.</li>
<li class="nx-my-2">3-3) RateLimiter::isAllowed(routerId, key) 에서 만들어낸 Response 객체가 isAllowed가 아니라면 별도로 responseStatus 를 세팅하고, exchange 의 response 의 상태를 complete 로 변경합니다.</li>
</ul>
<br/>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">RateLimiter<a href="#ratelimiter" id="ratelimiter" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/ratelimit/RateLimiter.java" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">RateLimiter<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li>
<li class="nx-my-2"><a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/ratelimit/AbstractRateLimiter.java" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">AbstractRateLimiter<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> : AbstractRateLimiter 의 내부 구현에 대해서는 설명을 생략합니다.</li>
</ul>
<br/>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">RateLimiter 는 interface 입니다. 이 interface 를 구현해서 필요에 맞게 다양한 구현체를 적용가능합니다. Spring Cloud Gateway 는 Redis 를 사용하는데, Spring Cloud Gateway 는 RateLimiter 에 대한 구현체로 RedisRateLimiter 를 채택하고 있습니다.<br/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">AbstractRateLimiter 에서는 RateLimiter 를 구현하는 데에 있어서 필요한 필수적인 로직들을 구현하고 있는 abstract 클래스입니다.<br/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">RateLimiter interface 의 내용은 아래와 같습니다.</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="java" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="java" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">package</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">org</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">springframework</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">cloud</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">gateway</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">filter</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">ratelimit</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">interface</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">RateLimiter</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">C</span><span style="color:var(--shiki-color-text)">&gt; </span><span style="color:var(--shiki-token-keyword)">extends</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">StatefulConfigurable</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">C</span><span style="color:var(--shiki-color-text)">&gt; {</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">	</span><span style="color:var(--shiki-token-keyword)">Mono</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">Response</span><span style="color:var(--shiki-color-text)">&gt; </span><span style="color:var(--shiki-token-function)">isAllowed</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)"> routeId</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)"> id);</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">	</span><span style="color:var(--shiki-token-keyword)">class</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">Response</span><span style="color:var(--shiki-color-text)"> {</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">private</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">final</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">boolean</span><span style="color:var(--shiki-color-text)"> allowed;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">private</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">final</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">long</span><span style="color:var(--shiki-color-text)"> tokensRemaining;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">private</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">final</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Map</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)">&gt; headers;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">Response</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">boolean</span><span style="color:var(--shiki-color-text)"> allowed</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Map</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)">&gt; headers) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">allowed</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> allowed;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">tokensRemaining</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-constant)">Assert</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">notNull</span><span style="color:var(--shiki-color-text)">(headers</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;headers may not be null&quot;</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">headers</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> headers;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">boolean</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">isAllowed</span><span style="color:var(--shiki-color-text)">() {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> allowed;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Map</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)">&gt; </span><span style="color:var(--shiki-token-function)">getHeaders</span><span style="color:var(--shiki-color-text)">() {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">Collections</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">unmodifiableMap</span><span style="color:var(--shiki-color-text)">(headers);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">		@</span><span style="color:var(--shiki-token-keyword)">Override</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">toString</span><span style="color:var(--shiki-color-text)">() {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">final</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">StringBuffer</span><span style="color:var(--shiki-color-text)"> sb </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">StringBuffer(</span><span style="color:var(--shiki-token-string-expression)">&quot;Response{&quot;</span><span style="color:var(--shiki-token-function)">)</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-constant)">sb</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;allowed=&quot;</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-color-text)">(allowed);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-constant)">sb</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;, headers=&quot;</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-color-text)">(headers);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-constant)">sb</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;, tokensRemaining=&quot;</span><span style="color:var(--shiki-color-text)">)</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-color-text)">(tokensRemaining);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-constant)">sb</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">append</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;}&#x27;</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">sb</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">toString</span><span style="color:var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">	}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Response 라고 하는 Response 데이터를 담는용도의 클래스가 정의되어 있으며, isAllowed(routeId, id) 를 메서드로 제공하고 있습니다.</p>
<br/>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">RedisRateLimiter<a href="#redisratelimiter" id="redisratelimiter" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/ratelimit/AbstractRateLimiter.java" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">AbstractRateLimiter<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> : AbstractRateLimiter 의 내부 구현에 대해서는 생략합니다.</li>
<li class="nx-my-2"><a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/main/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/ratelimit/RedisRateLimiter.java" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">RedisRateLimiter<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li>
</ul>
<br/>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">RedisRateLimiter 의 내용 중 이번 문서에서는 isAllowed(), lua 스크립트 를 알아볼 예정입니다.</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">isAllowed() 메서드</li>
<li class="nx-my-2">lua 스크립트</li>
</ul>
<br/>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">RedisRateLimiter::isAllowed() 메서드<a href="#redisratelimiterisallowed-메서드" id="redisratelimiterisallowed-메서드" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/af09c72a9a5dbc2240fd5d3de8293a9b7b80750d/spring-cloud-gateway-server/src/main/java/org/springframework/cloud/gateway/filter/ratelimit/RedisRateLimiter.java#L233" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">RedisRateLimiter::isAllowed() 메서드<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> 는 아래와 같이 정의되어 있습니다. 꽤 복잡해보이지만 크게 복잡한 내용은 없습니다.</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="java" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="java" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">package</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">org</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">springframework</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">cloud</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">gateway</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">filter</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">ratelimit</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">@</span><span style="color:var(--shiki-token-keyword)">ConfigurationProperties</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;spring.cloud.gateway.redis-rate-limiter&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">class</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">RedisRateLimiter</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">extends</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">AbstractRateLimiter</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">RedisRateLimiter</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">Config</span><span style="color:var(--shiki-color-text)">&gt; </span><span style="color:var(--shiki-token-keyword)">implements</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">ApplicationContextAware</span><span style="color:var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">private</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">RedisScript</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">List</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">Long</span><span style="color:var(--shiki-color-text)">&gt;&gt; script;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">RedisRateLimiter</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">ReactiveStringRedisTemplate</span><span style="color:var(--shiki-color-text)"> redisTemplate</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">RedisScript</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">List</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">Long</span><span style="color:var(--shiki-color-text)">&gt;&gt; script</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">ConfigurationService</span><span style="color:var(--shiki-color-text)"> configurationService) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		super(</span><span style="color:var(--shiki-token-constant)">Config</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">class</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> CONFIGURATION_PROPERTY_NAME</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> configurationService);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">redisTemplate</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> redisTemplate;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">script</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> script;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">initialized</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">compareAndSet</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-constant)">false</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">true</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">// ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    @</span><span style="color:var(--shiki-token-keyword)">Override</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	@</span><span style="color:var(--shiki-token-keyword)">SuppressWarnings</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;unchecked&quot;</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	</span><span style="color:var(--shiki-token-keyword)">public</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Mono</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">Response</span><span style="color:var(--shiki-color-text)">&gt; </span><span style="color:var(--shiki-token-function)">isAllowed</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)"> routeId</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)"> id) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">!</span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">initialized</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">get</span><span style="color:var(--shiki-color-text)">()) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">throw</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">IllegalStateException(</span><span style="color:var(--shiki-token-string-expression)">&quot;RedisRateLimiter is not initialized&quot;</span><span style="color:var(--shiki-token-function)">)</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		}</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">Config</span><span style="color:var(--shiki-color-text)"> routeConfig </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">loadConfiguration(routeId)</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-comment)">// (0)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-comment)">// How many requests per second do you want a user to be allowed to do?</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)"> replenishRate </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">routeConfig</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getReplenishRate</span><span style="color:var(--shiki-color-text)">();</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-comment)">// How much bursting do you want to allow?</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)"> burstCapacity </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">routeConfig</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getBurstCapacity</span><span style="color:var(--shiki-color-text)">();</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-comment)">// How many tokens are requested per request?</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">int</span><span style="color:var(--shiki-color-text)"> requestedTokens </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">routeConfig</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getRequestedTokens</span><span style="color:var(--shiki-color-text)">();</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">try</span><span style="color:var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">List</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)">&gt; keys </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">getKeys(id)</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">            </span><span style="color:var(--shiki-token-comment)">// (1)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-comment)">// The arguments to the LUA script. time() returns unixtime in seconds.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">List</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">String</span><span style="color:var(--shiki-color-text)">&gt; scriptArgs </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">Arrays</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">asList</span><span style="color:var(--shiki-color-text)">(replenishRate </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;&quot;</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> burstCapacity </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;&quot;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">					</span><span style="color:var(--shiki-token-constant)">Instant</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">now</span><span style="color:var(--shiki-color-text)">()</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">getEpochSecond</span><span style="color:var(--shiki-color-text)">() </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;&quot;</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> requestedTokens </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;&quot;</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            </span><span style="color:var(--shiki-token-comment)">// (2)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-comment)">// allowed, tokens_left = redis.eval(SCRIPT, keys, args)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">Flux</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">List</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">Long</span><span style="color:var(--shiki-color-text)">&gt;&gt; flux </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">redisTemplate</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">execute</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-constant)">this</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-constant)">script</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> keys</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> scriptArgs);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-comment)">// .log(&quot;redisratelimiter&quot;, Level.FINER);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">flux</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">onErrorResume</span><span style="color:var(--shiki-color-text)">(throwable </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">log</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">isDebugEnabled</span><span style="color:var(--shiki-color-text)">()) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">					</span><span style="color:var(--shiki-token-constant)">log</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">debug</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;Error calling rate limiter lua&quot;</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> throwable);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">Flux</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">just</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-constant)">Arrays</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">asList</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-constant)">1L</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1L</span><span style="color:var(--shiki-color-text)">));</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			})</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">reduce</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">ArrayList</span><span style="color:var(--shiki-color-text)">&lt;</span><span style="color:var(--shiki-token-keyword)">Long</span><span style="color:var(--shiki-color-text)">&gt;()</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> (longs</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> l) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-constant)">longs</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">addAll</span><span style="color:var(--shiki-color-text)">(l);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> longs;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			})</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">map</span><span style="color:var(--shiki-color-text)">(results </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">boolean</span><span style="color:var(--shiki-color-text)"> allowed </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">results</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">get</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">) </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">1L</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">Long</span><span style="color:var(--shiki-color-text)"> tokensLeft </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">results</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">get</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">Response</span><span style="color:var(--shiki-color-text)"> response </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">Response(allowed</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-function)"> getHeaders(routeConfig</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-function)"> tokensLeft))</span><span style="color:var(--shiki-color-text)">;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-constant)">log</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">isDebugEnabled</span><span style="color:var(--shiki-color-text)">()) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">					</span><span style="color:var(--shiki-token-constant)">log</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">debug</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;response: &quot;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)"> response);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">				</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> response;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			});</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">catch</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">Exception</span><span style="color:var(--shiki-color-text)"> e) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-comment)">/*</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">			 * We don&#x27;t want a hard dependency on Redis to allow traffic. Make sure to set</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">			 * an alert so you know if this is happening too much. Stripe&#x27;s observed</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">			 * failure rate is 0.01%.</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">			 */</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">			</span><span style="color:var(--shiki-token-constant)">log</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">error</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;Error determining if user allowed from redis&quot;</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> e);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">		</span><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">Mono</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">just</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-keyword)">new</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">Response(</span><span style="color:var(--shiki-token-constant)">true</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-function)"> getHeaders(routeConfig</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-token-function)"> </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-token-constant)">1L</span><span style="color:var(--shiki-token-function)">))</span><span style="color:var(--shiki-color-text)">);</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">	}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">}</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">(0)</code></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">replenishRate, burstCapacity, requestedTokens 와 같은 값들을 routeConfig 에서 가져옵니다. burstCapacity, replenishRate, requestedTokens 등과 같은 값들은 모두 개발자가 선언한 application.yml 파일에 정의되어 있는 내용입니다.</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">(1)</code></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">(0)</code> 에서 가져온 burstCapacity, replenishRate, requestedTokens 와 같은 인자값들을 문자열로 변형해서 List로 만듭니다.</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">(2)</code></p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">(2)</code> 에서는 redisTemplate 을 이용해서 lua script 를 실행시키는데, 이때 Argument 는 <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">(1)</code> 에서 초기화한 List&lt;String&gt; 입니다.</li>
<li class="nx-my-2">this.script 는 RedisRateLimiter 내에 정의된 <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">RedisScript&lt;List&lt;Long&gt;&gt;</code> 타입의 lua script 객체입니다.</li>
</ul>
<br/>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">lua 스크립트<a href="#lua-스크립트" id="lua-스크립트" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Lua 스크립트 - <a href="https://ko.wikipedia.org/wiki/%EB%A3%A8%EC%95%84_(%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D_%EC%96%B8%EC%96%B4)" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">위키<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> , <a href="https://namu.wiki/w/Lua" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">나무위키<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li>
<li class="nx-my-2">Redis - <a href="https://ko.wikipedia.org/wiki/%EB%A0%88%EB%94%94%EC%8A%A4" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">위키<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li>
<li class="nx-my-2">lua download - <a href="https://www.lua.org/download.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://www.lua.org/download.html<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li>
<li class="nx-my-2">lua binary : <a href="https://luabinaries.sourceforge.net/download.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://luabinaries.sourceforge.net/download.html<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li>
</ul>
<blockquote class="nx-mt-6 nx-border-gray-300 nx-italic nx-text-gray-700 dark:nx-border-gray-700 dark:nx-text-gray-400 first:nx-mt-0 ltr:nx-border-l-2 ltr:nx-pl-6 rtl:nx-border-r-2 rtl:nx-pr-6">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Mac OS 에서는 brew, Linux 에서는 apt-get 등과 같은 패키지 매니저를 통해서 설치 가능합니다. 제 경우에는 개발 PC를 깔끔하게 유지하는것을 선호하기에 온라인 에디터를 사용했고 온라인 에디터에 대해서는 <a href="https://replit.com/languages/lua" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://replit.com/languages/lua<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> 을 참고해주시기 바랍니다.<br/></p>
</blockquote>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Lua 스크립트는 레디스 내의 인터프리터는 Lua 스크립트를 읽을수 있으며 실행 가능합니다. Lua 스크립트를 사용하면, 레디스 머신 내에서 레디스 실행엔진이 Lua 스크립트를 인터프리터로 해석해서 스크립트를 실행합니다.<br/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">클라이언트인 각각의 개별 서비스에서 레디스의 List,Set 의 데이터를 복사한 후 열어서 접근할 때 레디스 입장에서는 동일한 값이 복제되었을 때에 대해 데이터가 모호해질 수 있습니다.<br/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">이런 경우에는 Redis 내에 구성한 List, Set 등과 같은 자료구조에 접근하는 주체가 Redis 머신이 되도록 바꿔주면, 데이터의 불일치 현상을 방지할 수 있습니다.<br/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Redis 에 Script 를 통해 접근하면 Redis 서버 내에서의 Atomic 연산을 보장해줍니다. 따라서 Rate Limiter, Coupon 발급기 같은 작업 대기열 기반 트래픽 처리를 할 때 유용합니다.<br/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Lua 라는 언어는 브라질에서 1993년도애 개발된 프로그래밍 언어인데, C/C++ 프로그램 내부에 포함시키기 쉬우면서 깔끔하고 쉬운 문법의 스크립트 언어입니다. Redis 는 C/C++ 기반으로 작성된 데이터 플랫폼입니다. 그리고 Lua 스크립트를 실행할 수 있도록 Lua 스크립트와 관련된 기능을 지원하고 있습니다.<br/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Lua 언어의 설치는 <a href="https://www.lua.org/download.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">https://www.lua.org/download.html<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> 에서 다운로드 받아서 설치 가능합니다.<br/></p>
<br/>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">request_rate_limiter.lua<a href="#request_rate_limiterlua" id="request_rate_limiterlua" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">만약 우리가 RedisLimiter 를 의존성 주입하지 않는다면 Spring Cloud Gateway 에서 기본으로 제공해주는 <a href="https://github.com/spring-cloud/spring-cloud-gateway/blob/main/spring-cloud-gateway-server/src/main/resources/META-INF/scripts/request_rate_limiter.lua" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">request_rate_limiter.lua<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>가 선택되어 사용하게 됩니다.<br/></p>
<blockquote class="nx-mt-6 nx-border-gray-300 nx-italic nx-text-gray-700 dark:nx-border-gray-700 dark:nx-text-gray-400 first:nx-mt-0 ltr:nx-border-l-2 ltr:nx-pl-6 rtl:nx-border-r-2 rtl:nx-pr-6">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">request_rate_limiter.lua 의 경로는 <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">spring-cloud-gateway-server/src/main/resources/META-INF/scripts/request_rate_limiter.lua</code> 입니다.</p>
</blockquote>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="lua" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="lua" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> tokens_key </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> KEYS[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> timestamp_key </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> KEYS[</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-color-text)">]</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;tokens_key &quot; .. tokens_key)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> rate </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">tonumber</span><span style="color:var(--shiki-color-text)">(ARGV[</span><span style="color:var(--shiki-token-constant)">1</span><span style="color:var(--shiki-color-text)">])</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> capacity </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">tonumber</span><span style="color:var(--shiki-color-text)">(ARGV[</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-color-text)">])</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> now </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">tonumber</span><span style="color:var(--shiki-color-text)">(ARGV[</span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-color-text)">])</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> requested </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">tonumber</span><span style="color:var(--shiki-color-text)">(ARGV[</span><span style="color:var(--shiki-token-constant)">4</span><span style="color:var(--shiki-color-text)">])</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> fill_time </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> capacity</span><span style="color:var(--shiki-token-keyword)">/</span><span style="color:var(--shiki-color-text)">rate</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> ttl </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">math.floor</span><span style="color:var(--shiki-color-text)">(fill_time</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-token-constant)">2</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;rate &quot; .. ARGV[1])</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;capacity &quot; .. ARGV[2])</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;now &quot; .. ARGV[3])</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;requested &quot; .. ARGV[4])</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;filltime &quot; .. fill_time)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;ttl &quot; .. ttl)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> last_tokens </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">tonumber</span><span style="color:var(--shiki-color-text)">(redis.</span><span style="color:var(--shiki-token-function)">call</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;get&quot;</span><span style="color:var(--shiki-color-text)">, tokens_key))</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> last_tokens </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">nil</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">then</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  last_tokens </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> capacity</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">end</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;last_tokens &quot; .. last_tokens)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> last_refreshed </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">tonumber</span><span style="color:var(--shiki-color-text)">(redis.</span><span style="color:var(--shiki-token-function)">call</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;get&quot;</span><span style="color:var(--shiki-color-text)">, timestamp_key))</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> last_refreshed </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">nil</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">then</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  last_refreshed </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">end</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;last_refreshed &quot; .. last_refreshed)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> delta </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">math.max</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)">, now</span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-color-text)">last_refreshed)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> filled_tokens </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-function)">math.min</span><span style="color:var(--shiki-color-text)">(capacity, last_tokens</span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-color-text)">(delta</span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-color-text)">rate))</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> allowed </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> filled_tokens </span><span style="color:var(--shiki-token-keyword)">&gt;=</span><span style="color:var(--shiki-color-text)"> requested</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> new_tokens </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> filled_tokens</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">local</span><span style="color:var(--shiki-color-text)"> allowed_num </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> allowed </span><span style="color:var(--shiki-token-keyword)">then</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  new_tokens </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> filled_tokens </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-color-text)"> requested</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  allowed_num </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">1</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">end</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;delta &quot; .. delta)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;filled_tokens &quot; .. filled_tokens)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;allowed_num &quot; .. allowed_num)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">--redis.log(redis.LOG_WARNING, &quot;new_tokens &quot; .. new_tokens)</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> ttl </span><span style="color:var(--shiki-token-keyword)">&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">then</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  redis.</span><span style="color:var(--shiki-token-function)">call</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;setex&quot;</span><span style="color:var(--shiki-color-text)">, tokens_key, ttl, new_tokens)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  redis.</span><span style="color:var(--shiki-token-function)">call</span><span style="color:var(--shiki-color-text)">(</span><span style="color:var(--shiki-token-string-expression)">&quot;setex&quot;</span><span style="color:var(--shiki-color-text)">, timestamp_key, ttl, now)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">end</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)">-- return { allowed_num, new_tokens, capacity, filled_tokens, requested, new_tokens }</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">return</span><span style="color:var(--shiki-color-text)"> { allowed_num, new_tokens }</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
<br/>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">자바 코드에서는 아래의 인자값을 넘겨줬었습니다.</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">replenishRate</li>
<li class="nx-my-2">burstCapacity</li>
<li class="nx-my-2">Instant.now().getEpochSecond() : 초 단위로 구분된 Epoch Time</li>
<li class="nx-my-2">requestedTokens</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">위의 스크립트에서는 위의 인자값들을 <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">ARGV</code> 라는 배열로 받습니다.<br/></p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">위의 코드는 Token Bucket Algorithm 이 구현된 것인데, Token Bucket Algorithm 에 대해서는 문서가 길어지게 되어서 별도의 문서에서 따로 정리하기로 결정했습니다.<br/></p>
<br/><div class="nx-mt-16"></div><div class="nx-mb-8 nx-flex nx-items-center nx-border-t nx-pt-8 dark:nx-border-neutral-800 contrast-more:nx-border-neutral-400 dark:contrast-more:nx-border-neutral-400 print:nx-hidden"><a title="Custom Rate Limiter 예제" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-pr-4 rtl:nx-pl-4" href="/docs-spring-cloud-gateway/rate-limiter/example-custom-rate-limiter/"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 ltr:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>Custom Rate Limiter 예제</a><a title="Token Bucket Algorithm (Lua)" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-ml-auto ltr:nx-pl-4 ltr:nx-text-right rtl:nx-mr-auto rtl:nx-pr-4 rtl:nx-text-left" href="/docs-spring-cloud-gateway/rate-limiter/token-bucket-algorithm/">Token Bucket Algorithm (Lua)<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 rtl:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></a></div></main></article></div><footer class="nx-bg-gray-100 nx-pb-[env(safe-area-inset-bottom)] dark:nx-bg-neutral-900 print:nx-bg-transparent"><div class="nx-mx-auto nx-flex nx-max-w-[90rem] nx-gap-2 nx-py-2 nx-px-4 nx-hidden"><button title="Change theme" class="nx-h-7 nx-rounded-md nx-px-2 nx-text-left nx-text-xs nx-font-medium nx-text-gray-600 nx-transition-colors dark:nx-text-gray-400 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50" id="headlessui-listbox-button-:Rkt6:" type="button" aria-haspopup="listbox" aria-expanded="false" data-headlessui-state=""><div class="nx-flex nx-items-center nx-gap-2 nx-capitalize"><svg fill="none" viewBox="3 3 18 18" width="12" height="12" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="currentColor" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><span class="">Light</span></div></button></div><hr class="dark:nx-border-neutral-800"/><div class="nx-mx-auto nx-flex nx-max-w-[90rem] nx-justify-center nx-py-12 nx-text-gray-600 dark:nx-text-gray-400 md:nx-justify-start nx-pl-[max(env(safe-area-inset-left),1.5rem)] nx-pr-[max(env(safe-area-inset-right),1.5rem)]">Nextra Docs Template</div></footer></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{}},"page":"/rate-limiter/inside-redis-rate-limiter","query":{},"buildId":"Pl6EMUw0X40lqWZeQ6ErJ","assetPrefix":"/docs-spring-cloud-gateway","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>